# vim: set ft=tmux:

# reload config with <prefix> + R
# ---
# check set options:
# show-options [-spw] [-g],
#   -s (server), -p (pane), -w (window)
#   -g (global)
# ---
# common key bindings (prefix required):
#   c - new window, p - prev window, n - next window
#   Shift + Left - prev window, + Right - next window, + Down - new window
#   v - split vertically
#   h - split horizontally
#   H/J/K/L - resize panes
#   q - briefly show pane numbers and switch to n-th pane if n pressed, where n is a number
#   w - show windows
#   x - close current pane
#   X - close current window
#   O - leave only this window open
# more (no prefix required):
#   Ctrl-h/j/k/l - switch panes
#   M-s - session management
#   M-x - kill pane
#   M-X - kill window
# ---
# copy mode
# most keybindings resemble the ones of vim:
#   How to copy:
#     prefix + [ to enter tmux vi copy mode
#     Begin highlight with Space/v (visual selection), V (linewise selection), Ctrl-v (blockwise selection)
#     Copy with Enter or y
#     Paste with prefix + ]
#   ---
#   How to scroll:
#     Half page down               C-d
#     Half page up                 C-u
#     Next page                    C-f
#     Previous page                C-b
#     Scroll down                  C-Down or C-e
#     Scroll up                    C-Up or C-y
#   How to search:
#     Search          / or ? (forward, backward)
#     Search again    n or N (forward, backward)
#
# ----------------------------------------------
#

set -g default-terminal "tmux-256color"
set -g terminal-overrides ',xterm-256color:Tc'
set -as terminal-overrides ',xterm*:sitm=\E[3m'

set -g focus-events on
set -g set-clipboard on
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g history-limit 50000

# Let escape sequences pass through (generally helpful with modern terminals)
set -g allow-passthrough on

# Enable bell monitoring and show bell alerts for any window (not just current)
set -g monitor-bell on
set -g bell-action any

set -g status-interval 5
set -g automatic-rename on
# show directory name for shells, command name for everything else
set -g automatic-rename-format "#{?#{==:#{pane_current_command},zsh},#{b:pane_current_path},#{pane_current_command}}"

# better mouse support via 'nhdaly/tmux-better-mouse-mode'
set -g mouse on
set -g @scroll-down-exit-copy-mode "on"
set -g @emulate-scroll-for-no-mouse-alternate-buffer "on"
set -g @scroll-speed-num-lines-per-scroll "3"

# copy mode
# use vi-style key bindings in copy mode
setw -g mode-keys vi

# enter copy-mode with Enter
bind Enter copy-mode

# add more vi-style key bindings:
#   - visual mode with 'v'
#   - visual rectange mode with 'ctrl-v'/'ctrl-q'
#   - yank with 'y'
unbind -T copy-mode-vi v
unbind -T copy-mode-vi MouseDragEnd1Pane
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi м send -X begin-selection
bind -T copy-mode-vi 'C-q' send -X rectangle-toggle \; send -X begin-selection
bind -T copy-mode-vi 'C-c' send -X copy-pipe
bind -T copy-mode-vi y send -X copy-pipe
bind -T copy-mode-vi н send -X copy-pipe
# pasting with lowercase 'p' is not possible as this keybinding is used for going to prev window
bind P paste-buffer
# copy with dragging
# not needed, already works
# bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-and-cancel 'clip'

# set low value to avoid any delay when switching modes in Vim
set -s escape-time 10
# time in ms to repeat the last keybind if it's repeatable (-r option).
# For instance, <prefix> + x closes the current pane and can be repeated;
# or <prefix> + </>, which moves the window
set -g repeat-time 400

# set a new prefix
unbind C-b
set -g prefix  M-a
set -g prefix2 M-Space
bind   M-a     send-prefix
bind   M-Space send-prefix

# switch windows via:
# open a new window via Shift + down arrow
bind -n S-Left previous-window
bind -n S-Right next-window
bind -n S-Down new-window -c "#{pane_current_path}"
bind -n M-Left previous-window
bind -n M-Right next-window
bind -n M-Down new-window -c "#{pane_current_path}"
bind -n M-h previous-window
bind -n M-l next-window

bind -r "<" swap-window -d -t -1
bind -r ">" swap-window -d -t +1

bind -r "x" kill-pane
bind -r "X" kill-window
# close all windows but current
bind "O" kill-window -a

# buffer picker
bind b choose-buffer

# session picker
bind -n M-s choose-tree -Zs

# kill current pane
bind -n M-x kill-pane
# kill current window
bind -n M-X kill-window

# add more intuitive keybindings
# I use reversed horizontal/vertical mappings because these make much more sense to me
bind-key h split-window -v -c "#{pane_current_path}"
bind-key v split-window -h -c "#{pane_current_path}"

# resize panes
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5


# ------------
# Status line
# ------------

# spaceduck
# https://github.com/pineapplegiant/spaceduck-terminal/blob/main/tmux/status-line-default.conf
# ---------

set -g status-justify "left"
set -g status "on"
set -g status-left-style "none"

# Middle section
set -g message-command-style "fg=#1b1c36,bg=#686f9a"
set -g status-right-style "none"
set -g status-style "none,bg=#1b1c36"

# Active border on pane
set -g pane-active-border-style "fg=#5ccc96"

# When commands are run
set -g message-style "fg=#0f111b,bg=#b3a1e6"

# Inactive border on pane
set -g pane-border-style "fg=#686f9a"
set -g status-right-length "100"
set -g status-left-length "100"
setw -g window-status-activity-style "none,fg=#686f9a,bg=#1b1c36"
setw -g window-status-bell-style "none,fg=#686f9a,bg=#1b1c36"
setw -g window-status-last-style "none,fg=#686f9a,bg=#1b1c36"
setw -g window-status-current-style "none,fg=#1b1c36,bg=#686f9a"

# Separator colors
setw -g window-status-separator ""
setw -g window-status-style "none,fg=#686f9a,bg=#1b1c36"

# Left
set -g status-left "#[fg=#0f111b,bg=#30365F] #S #[fg=#30365F,bg=#1b1c36,nobold,nounderscore,noitalics]"

# Right
set -g status-right "#[fg=#1b1c36,bg=#1b1c36,nobold,nounderscore,noitalics]#[fg=#686f9a,bg=#1b1c36] %Y-%m-%d  %H:%M #[fg=#30365F,bg=#1b1c36,nobold,nounderscore,noitalics]#[fg=#1b1c36,bg=#30365F] #h "
# Inactive window
setw -g window-status-format "#[fg=#686f9a,bg=#1b1c36] #I #[fg=#686f9a,bg=#1b1c36] #W#{?window_bell_flag, #[fg=#f6c177,bg=#1b1c36]!,} "

# Active window
setw -g window-status-current-format "#[fg=#1b1c36,bg=#686f9a,nobold,nounderscore,noitalics]#[fg=#1b1c36,bg=#686f9a] #I #[fg=#1b1c36,bg=#686f9a] #W #[fg=#686f9a,bg=#1b1c36,nobold,nounderscore,noitalics]"


# define modules to be used
# ---



# --------------
# tmux continuum
# --------------

# in minutes
set -g @continuum-save-interval '1'
set -g @continuum-restore 'on'


# --------
# PLUGINS
# --------

# Install plugins with <prefix> + I
# Update plugins with <prefix> + U

set -g @plugin 'tmux-plugins/tpm#99469c4'
set -g @plugin 'tmux-plugins/tmux-sensible#25cb91f'

# switch seamlessly between both tmux and vim panes
# the same plugin is installed in Vim as well
# the default mappings are Ctrl-h/j/k/l
set -g @plugin 'christoomey/vim-tmux-navigator#412c474'

set -g @plugin 'soyuka/tmux-current-pane-hostname#0d29e90'

set -g @plugin 'nhdaly/tmux-better-mouse-mode#aa59077'

set -g @plugin 'alexwforsythe/tmux-which-key#1f41977'

set -g @plugin 'tmux-plugins/tmux-resurrect#v4.0.0'
set -g @plugin 'tmux-plugins/tmux-continuum#v3.1.0'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
